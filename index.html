<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>罗塞塔帝国研究所 | Rosetta Archives</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@300;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #020305;
            --card-bg: rgba(10, 14, 20, 0.7);
            --card-border: rgba(212, 175, 55, 0.15);
            --gold: #d4af37;
            --gold-light: #f9d976;
            --gold-dim: #8a702a;
            --text-main: #e0e0e0;
            --text-muted: #7a8599;
            --accent-blue: #4facfe;
            --holo-blue: rgba(79, 172, 254, 0.4);
            --map-bg: #050505;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Playfair Display', serif;
            overflow-x: hidden;
            /* 细微的噪点背景，增加胶片感 */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* 滚动条美化 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 3px; }

        /* ================= 装饰线条与HUD ================= */
        .line-deco {
            position: fixed; top: 0; bottom: 0; width: 1px;
            background: linear-gradient(to bottom, transparent, var(--gold-dim), transparent);
            z-index: -1; opacity: 0.2;
        }
        .line-left { left: 60px; }
        .line-right { right: 60px; }

        .hud-nav {
            position: fixed; top: 0; width: 100%; height: 50px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 4rem; background: rgba(2, 3, 5, 0.85);
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            z-index: 1000; backdrop-filter: blur(8px);
            font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--gold);
            letter-spacing: 1px;
        }

        /* ================= HEADER (视觉升级) ================= */
        header {
            height: 100vh;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            position: relative; overflow: hidden;
            /* 深邃的星云背景 */
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }

        /* 动态星云层 */
        .nebula {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 50% 50%, rgba(79, 172, 254, 0.05), transparent 60%),
                radial-gradient(circle at 80% 20%, rgba(212, 175, 55, 0.03), transparent 40%);
            animation: nebulaPulse 10s ease-in-out infinite alternate;
            z-index: 0;
        }
        @keyframes nebulaPulse { 0% { opacity: 0.5; transform: scale(1); } 100% { opacity: 1; transform: scale(1.1); } }

        #starCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; opacity: 0.8; }

        /* 精密星盘 (Astrolabe) 效果 */
        .orbit-system {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 800px; height: 800px;
            pointer-events: none; z-index: 2;
        }
        .orbit-ring {
            position: absolute; top: 50%; left: 50%; border-radius: 50%;
            border: 1px solid rgba(212, 175, 55, 0.1);
            transform: translate(-50%, -50%);
        }
        .ring-outer { width: 100%; height: 100%; border-width: 1px; border-style: solid; animation: rot 120s linear infinite; }
        .ring-mid { width: 70%; height: 70%; border: 1px dashed rgba(79, 172, 254, 0.2); animation: rot-inv 80s linear infinite; }
        .ring-inner { width: 40%; height: 40%; border: 2px solid rgba(212, 175, 55, 0.2); box-shadow: 0 0 30px rgba(212, 175, 55, 0.05); }
        .ring-deco { 
            width: 110%; height: 110%; 
            border: 1px dotted rgba(255,255,255,0.1); 
            animation: rot 200s linear infinite; 
        }

        @keyframes rot { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }
        @keyframes rot-inv { from { transform: translate(-50%, -50%) rotate(360deg); } to { transform: translate(-50%, -50%) rotate(0deg); } }

        .header-content {
            z-index: 10; padding: 3rem;
            background: rgba(5, 6, 8, 0.6);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(212, 175, 55, 0.1);
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            text-align: center;
            transform: translateY(0);
            transition: transform 0.3s;
        }

        .hero-logo {
            font-family: 'Cinzel', serif;
            font-size: clamp(3rem, 7vw, 6rem);
            background: linear-gradient(to bottom, var(--gold-light), var(--gold-dim));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.15em;
            margin-bottom: 0.5rem;
            filter: drop-shadow(0 0 15px rgba(212, 175, 55, 0.3));
        }

        .sub-hero {
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent-blue);
            letter-spacing: 0.3em;
            font-size: 0.9rem;
            text-transform: uppercase;
            border-top: 1px solid var(--gold-dim);
            padding-top: 1.5rem; margin-top: 1rem;
            position: relative;
        }
        .sub-hero::before {
            content: ''; position: absolute; top: -1px; left: 50%; transform: translateX(-50%);
            width: 50px; height: 3px; background: var(--gold);
        }

        /* ================= 视图控制 (新增) ================= */
        .view-controls {
            display: flex; justify-content: center; gap: 2rem;
            margin: 4rem auto 2rem; z-index: 50; position: relative;
        }
        .view-btn {
            background: transparent; border: 1px solid var(--gold-dim);
            color: var(--text-muted); padding: 0.8rem 2rem;
            font-family: 'Cinzel', serif; cursor: pointer;
            transition: all 0.3s; position: relative; overflow: hidden;
            font-size: 1rem;
        }
        .view-btn.active, .view-btn:hover {
            color: #000; background: var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            border-color: var(--gold);
        }

        /* ================= 卡片网格 (改进) ================= */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 5% 100px; min-height: 60vh; position: relative; }
        
        .section-header {
            display: flex; align-items: center; justify-content: center; gap: 1rem;
            margin: 4rem 0 2rem;
            font-family: 'Cinzel', serif; font-size: 1.8rem; color: var(--text-main);
        }
        .section-header i { color: var(--gold-dim); font-size: 1.2rem; }

        .grid-view { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 2rem; animation: fadeIn 0.8s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* 新版卡片样式 */
        .card {
            background: linear-gradient(145deg, rgba(15, 20, 28, 0.9) 0%, rgba(10, 12, 16, 0.95) 100%);
            border: 1px solid var(--card-border);
            padding: 2rem; position: relative;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%); /* 缺角设计 */
        }
        
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
            background: var(--gold-dim); transition: 0.3s;
        }
        
        .card:hover {
            transform: translateY(-8px);
            border-color: var(--gold);
            box-shadow: 0 15px 30px rgba(0,0,0,0.5);
        }
        .card:hover::before { background: var(--gold); box-shadow: 0 0 10px var(--gold); }

        /* 图标美化：勋章风格 */
        .card-emblem {
            position: absolute; top: 20px; right: 20px;
            width: 60px; height: 60px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(212,175,55,0.1) 0%, transparent 70%);
            border: 1px solid rgba(212,175,55,0.2);
            font-size: 1.8rem; color: var(--gold);
            transition: 0.5s;
        }
        .card:hover .card-emblem {
            background: rgba(212,175,55,0.2);
            box-shadow: 0 0 15px rgba(212,175,55,0.2);
            transform: rotate(30deg);
        }

        .card-title { font-family: 'Cinzel', serif; font-size: 1.4rem; color: #fff; margin-bottom: 0.5rem; padding-right: 50px; }
        .card-leader { font-family: 'Playfair Display', italic; color: var(--accent-blue); font-size: 0.95rem; margin-bottom: 1.2rem; display: block;}
        .card-desc { font-family: 'JetBrains Mono', sans-serif; font-size: 0.85rem; color: #889; line-height: 1.7; font-weight: 300; }
        
        .card-meta {
            margin-top: 2rem; padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.05);
            display: flex; justify-content: space-between; align-items: center;
            font-family: 'JetBrains Mono'; font-size: 0.7rem; color: var(--text-muted);
        }

        /* ================= 地图视图 (新功能) ================= */
        .map-view {
            display: none; /* 默认隐藏 */
            position: relative;
            width: 100%; height: 80vh;
            background: #080a10;
            border: 1px solid var(--gold-dim);
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
            animation: fadeIn 0.8s ease;
        }
        
        .world-map-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            /* 使用高对比度深色世界地图 SVG */
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg');
            background-size: cover;
            background-position: center;
            filter: invert(90%) hue-rotate(180deg) brightness(0.7) contrast(1.2) grayscale(100%);
            opacity: 0.3;
        }
        
        /* 地图上的网格线 */
        .map-grid-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(79, 172, 254, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(79, 172, 254, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
        }

        .map-point {
            position: absolute;
            width: 12px; height: 12px;
            background: var(--gold);
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.2);
            transition: all 0.3s;
            z-index: 10;
        }
        .map-point::after {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 40px; height: 40px;
            border: 1px solid var(--accent-blue);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0.5);
            opacity: 0; transition: 0.3s;
        }
        .map-point:hover { transform: translate(-50%, -50%) scale(1.2); background: #fff; z-index: 20; }
        .map-point:hover::after { opacity: 1; transform: translate(-50%, -50%) scale(1); animation: radarPing 1.5s infinite; }

        @keyframes radarPing { 0% { transform: translate(-50%,-50%) scale(0.8); opacity: 1; } 100% { transform: translate(-50%,-50%) scale(1.5); opacity: 0; } }

        /* 地图标记名称 */
        .point-label {
            position: absolute; top: -35px; left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: var(--gold); border: 1px solid var(--gold);
            padding: 4px 10px; font-family: 'JetBrains Mono'; font-size: 0.7rem;
            white-space: nowrap; pointer-events: none;
            opacity: 0; transition: 0.3s;
            backdrop-filter: blur(2px);
        }
        .map-point:hover .point-label { opacity: 1; top: -45px; }

        /* ================= 模态框与杂项 ================= */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: 0.4s; z-index: 2000; backdrop-filter: blur(15px);
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        
        .modal-content {
            background: #0b0d12; width: 90%; max-width: 700px;
            border: 1px solid var(--gold);
            box-shadow: 0 0 100px rgba(212, 175, 55, 0.1);
            position: relative; overflow: hidden;
        }
        
        /* 模态框内部的高科技扫描线 */
        .modal-content::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%; pointer-events: none; z-index: 1;
        }
        
        .modal-body-inner { padding: 4rem; position: relative; z-index: 2; }

        .drag-source {
            position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px;
            border-radius: 50%; border: 1px solid rgba(79, 172, 254, 0.3);
            display: flex; justify-content: center; align-items: center;
            opacity: 0.3; transition: 0.5s; cursor: grab; z-index: 100;
        }
        .drag-source:hover { opacity: 1; background: rgba(79, 172, 254, 0.1); box-shadow: 0 0 20px var(--accent-blue); }
        .drag-source i { color: var(--accent-blue); }

        footer {
            border-top: 1px solid var(--gold-dim); padding: 4rem 5%;
            background: #020203; text-align: center;
            font-family: 'Cinzel', serif; font-size: 0.9rem; color: #555;
        }
    </style>
</head>
<body>

    <div class="line-deco line-left"></div>
    <div class="line-deco line-right"></div>

    <nav class="hud-nav">
        <div><i class="fas fa-satellite-dish" style="margin-right:10px;"></i>ROSETTA MAINNET</div>
        <div id="clock">00:00:00 UTC</div>
        <div>SECURE LINK <i class="fas fa-lock" style="color:var(--gold); margin-left:5px;"></i></div>
    </nav>

    <header>
        <div class="nebula"></div>
        <canvas id="starCanvas"></canvas>
        
        <div class="orbit-system">
            <div class="orbit-ring ring-deco"></div>
            <div class="orbit-ring ring-outer"></div>
            <div class="orbit-ring ring-mid"></div>
            <div class="orbit-ring ring-inner"></div>
        </div>

        <div class="header-content">
            <div style="font-family: 'Cinzel'; font-size: 0.9rem; color: #888; margin-bottom: 1rem;">EST. GENESIS ERA</div>
            <div class="hero-logo">ROSETTA</div>
            <div class="sub-hero">
                Imperial Institute Archives<br>
                <span style="font-size:0.6rem; color:#666; margin-top:5px; display:block;">Observing the Multiverse</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="view-controls">
            <button class="view-btn active" onclick="switchView('grid')"><i class="fas fa-th-large"></i> ARCHIVES</button>
            <button class="view-btn" onclick="switchView('map')"><i class="fas fa-globe-europe"></i> WORLD MAP</button>
        </div>

        <div id="view-grid">
            <div class="section-header"><i class="fas fa-chess-king"></i> The Supreme Committee</div>
            <div class="grid-view" id="grid-level1"></div>

            <div class="section-header"><i class="fas fa-atom"></i> Secondary Institutes</div>
            <div class="grid-view" id="grid-level2"></div>

            <div class="section-header"><i class="fas fa-mug-hot"></i> Tertiary Institutes</div>
            <div class="grid-view" id="grid-level3"></div>
        </div>

        <div id="view-map" class="map-view">
            <div class="world-map-bg"></div>
            <div class="map-grid-overlay"></div>
            <div id="map-points-container" style="position: relative; width: 100%; height: 100%;"></div>
            
            <div style="position: absolute; bottom: 20px; left: 20px; font-family: 'JetBrains Mono'; color: var(--gold); font-size: 0.8rem; background: rgba(0,0,0,0.7); padding: 10px; border: 1px solid var(--gold-dim);">
                <i class="fas fa-crosshairs"></i> TRACKING ACTIVE ASSETS...
            </div>
        </div>
    </div>

    <footer>
        <p>© ROSETTA IMPERIAL INSTITUTE</p>
        <p style="margin-top:10px; font-family:'JetBrains Mono'; color:#333; font-size:0.7rem;">
            SYSTEM TERMINAL V.9.0.1 // UNAUTHORIZED ACCESS IS PROHIBITED
        </p>
    </footer>

    <div class="drag-source" draggable="true" id="secretGem" title="Drag to reveal secrets">
        <i class="fas fa-gem"></i>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            <button onclick="closeModal()" style="position:absolute; top:15px; right:20px; background:none; border:none; color:var(--gold); font-size:2rem; cursor:pointer; z-index:10;">×</button>
            <div class="modal-body-inner" id="modal-body"></div>
        </div>
    </div>

    <script>
        // ================= 基础逻辑与数据 =================
        const database = [
            { id: 'scc', level: 1, icon: 'fa-chess-queen', color: '#d4af37', name: 'Starry Counters Committee', cnName: '星空计数人委员会', leader: 'Elizabeth Maggie', loc: 'Dubai', mapCoords: {x: 61, y: 45}, desc: '罗塞塔帝国研究所的核心大脑。统筹狄俄尼修斯计划与星空计数事务。', fullText: '责任会长: 伊丽莎白·玛吉。<br>地点: 哈利法塔顶层。一切的起点，也是终点。' },
            { id: 'vivian', level: 2, icon: 'fa-atom', color: '#800020', name: 'Inst. of Heavy Elements', cnName: '薇薇安学院', leader: 'Vivian Lise Meitner', loc: 'Leipzig', mapCoords: {x: 52, y: 28}, desc: '历史最悠久的二级机构。提供了模拟粒子对撞机方案。', fullText: '全称: 重元素与理论物理研究院。<br>地点: 德国莱比锡。<br>薇薇安是研究所最受尊敬的院长之一。' },
            { id: 'honey', level: 2, icon: 'fa-eye', color: '#ff0000', name: 'Honey Badger Commando', cnName: '蜜獾突击队', leader: 'Iris Victoria', loc: 'London', mapCoords: {x: 48, y: 28}, desc: '有神力者特别观测站。负责间谍潜伏与暗杀任务。', fullText: '全称: 有神力者特别观测站与秘密事务执行处。<br>蜜獾是胆量最大的哺乳动物。' },
            { id: 'math', level: 2, icon: 'fa-square-root-variable', color: '#4facfe', name: 'Inst. of Applied Math', cnName: '应用数学研究院', leader: 'Lowery Nihility', loc: 'Naples', mapCoords: {x: 53, y: 35}, desc: '负责构建罗塞塔帝国研究所的数学基石与逻辑模型。', fullText: '地点: 意大利那不勒斯。<br>虚无(Nihility)并不代表不存在。' },
            { id: 'physics', level: 2, icon: 'fa-magnet', color: '#1e3a8a', name: 'Inst. of Applied Physics', cnName: '应用物理研究院', leader: 'Hypatia', loc: 'Dublin', mapCoords: {x: 46, y: 27}, desc: '致力于物理法则的应用与工程化。', fullText: '地点: 爱尔兰都柏林。<br>为了纪念那位亚历山大图书馆的女儿。' },
            { id: 'riken', level: 2, icon: 'fa-flask', color: '#581c87', name: 'Riken (Phys-Chem)', cnName: '理化学研究院', leader: 'Tapetit Berat Ecari', loc: 'Paris', mapCoords: {x: 49, y: 30}, desc: '跨学科研究的前沿阵地，融合物理与化学的奇迹。', fullText: '地点: 法国巴黎。<br>院长: 塔贝蒂·贝拉特·埃卡里。' },
            { id: 'icc', level: 2, icon: 'fa-globe', color: '#2f3e46', name: 'I.C.C.', cnName: '国际威慑委员会', leader: 'Alexander Pluto Ritter', loc: 'New York', mapCoords: {x: 29, y: 32}, desc: '政府间友好关系协商与国际威慑委员会。', fullText: '地点: 纽约时代广场。<br>威慑(Deterrence)才是和平的前提。' },
            { id: 'data', level: 2, icon: 'fa-database', color: '#d4af37', name: 'Data Processing Center', cnName: '数据处理与预算中心', leader: 'Edward von Parmian', loc: 'Philadelphia', mapCoords: {x: 28, y: 33}, desc: '数字生命 "EEE" 的诞生地，也是研究所的金库。', fullText: '地点: 费城。<br>组长: 爱德华·德·帕米安 (图灵)。' },
            { id: 'raccoon', level: 2, icon: 'fa-shield-halved', color: '#333', name: 'Raccoon Club', cnName: '适应性武装作战部队', leader: 'Ferdinand de Saussure', loc: 'Churchill', mapCoords: {x: 23, y: 22}, desc: '总司令处。负责武装作战与海岸巡逻。', fullText: '地点: 加拿大丘吉尔镇。<br>俗称浣熊俱乐部。' },
            { id: 'library', level: 2, icon: 'fa-book-skull', color: '#006400', name: 'Library of Moliere', cnName: '莫里哀图书馆', leader: 'Albert Theodore Ghiorso', loc: 'Versailles', mapCoords: {x: 49, y: 31}, desc: '特殊文献资料存放处。无论多么危险的知识，这里都有。', fullText: '地点: 凡尔赛。<br>馆长: 阿尔伯特·西奥多·吉奥索。' },
            { id: 'astro', level: 2, icon: 'fa-star', color: '#fff', name: 'Hubble-Kepler Obs.', cnName: '哈勃·开普勒天文台', leader: 'Hipparchus', loc: 'Panama City', mapCoords: {x: 26, y: 48}, desc: '今天你看星星了吗？', fullText: '地点: 巴拿马城。<br>我们一直在仰望星空。' },
            { id: 'crypto', level: 2, icon: 'fa-key', color: '#8a702a', name: 'Inst. of Cryptography', cnName: '语言与密码学研究院', leader: 'Saussure / Morse', loc: 'Geneva', mapCoords: {x: 50, y: 31}, desc: '加密、反间谍与文件保护。雨痕密码的发源地。', fullText: '地点: 瑞士日内瓦。<br>别称：日内瓦养老院。' },
            { id: 'madeleine', level: 3, icon: 'fa-cake-candles', color: '#e0b0ff', name: 'Madeleine Institute', cnName: '玛德琳研究院', leader: 'Arcadia C. Madeleine', loc: 'Lyon', mapCoords: {x: 50, y: 32}, desc: '虽是三级机构，却是研究所内最甜蜜、影响力最大的地方。', fullText: '地点: 法国里昂。<br>活着是为了什么？为了玛德琳小蛋糕。' }
        ];

        // ================= 渲染列表视图 =================
        function renderGrid() {
            const grid1 = document.getElementById('grid-level1');
            const grid2 = document.getElementById('grid-level2');
            const grid3 = document.getElementById('grid-level3');

            database.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                
                // 拖拽相关
                card.setAttribute('ondrop', 'drop(event)');
                card.setAttribute('ondragover', 'allowDrop(event)');
                
                card.innerHTML = `
                    <div class="card-emblem"><i class="fas ${item.icon}"></i></div>
                    <h3 class="card-title">${item.name}</h3>
                    <span class="card-leader">${item.leader}</span>
                    <p class="card-desc">${item.desc}</p>
                    <div class="card-meta">
                        <span><i class="fas fa-map-marker-alt"></i> ${item.loc.toUpperCase()}</span>
                        <span style="color:${item.color}">● STATUS: ACTIVE</span>
                    </div>
                `;
                
                card.onclick = () => openModal(item);

                if (item.level === 1) grid1.appendChild(card);
                else if (item.level === 2) grid2.appendChild(card);
                else grid3.appendChild(card);
            });
        }

        // ================= 渲染地图视图 =================
        function renderMap() {
            const container = document.getElementById('map-points-container');
            // 简单的坐标偏移修正（适应这张SVG地图的投影）
            // 这里的 mapCoords 是基于百分比的 (x=Left, y=Top)
            
            database.forEach(item => {
                const point = document.createElement('div');
                point.className = 'map-point';
                point.style.left = item.mapCoords.x + '%';
                point.style.top = item.mapCoords.y + '%';
                if(item.color) point.style.backgroundColor = item.color;

                point.innerHTML = `
                    <div class="point-label">
                        ${item.name} [${item.loc}]
                    </div>
                `;
                
                point.onclick = (e) => {
                    e.stopPropagation();
                    openModal(item);
                };
                container.appendChild(point);
            });
        }

        // ================= 视图切换逻辑 =================
        function switchView(viewName) {
            const gridDiv = document.getElementById('view-grid');
            const mapDiv = document.getElementById('view-map');
            const btns = document.querySelectorAll('.view-btn');

            if(viewName === 'grid') {
                gridDiv.style.display = 'block';
                mapDiv.style.display = 'none';
                btns[0].classList.add('active');
                btns[1].classList.remove('active');
            } else {
                gridDiv.style.display = 'none';
                mapDiv.style.display = 'block';
                btns[0].classList.remove('active');
                btns[1].classList.add('active');
                // 触发一次 resize 以防地图渲染问题
                window.dispatchEvent(new Event('resize'));
            }
        }

        // ================= 模态框逻辑 =================
        function openModal(item) {
            const body = document.getElementById('modal-body');
            body.innerHTML = `
                <div style="text-align:center; color:${item.color || '#d4af37'}; font-size:4rem; margin-bottom:1.5rem; filter:drop-shadow(0 0 20px ${item.color})">
                    <i class="fas ${item.icon}"></i>
                </div>
                <h2 style="font-family:'Cinzel'; font-size:2rem; color:#d4af37; margin-bottom:0.5rem; text-align:center; border-bottom:1px solid #333; padding-bottom:10px;">${item.cnName}</h2>
                <div style="font-family:'JetBrains Mono'; font-size:0.9rem; color:var(--accent-blue); margin-bottom:2rem; text-align:center; letter-spacing:1px;">${item.name.toUpperCase()}</div>
                
                <div style="font-family:'Playfair Display'; font-size:1.2rem; line-height:1.8; color:#ddd; padding: 0 2rem;">
                    ${item.fullText}
                </div>

                <div style="margin-top:3rem; display:flex; justify-content:space-between; font-family:'JetBrains Mono'; font-size:0.7rem; color:#555;">
                    <div>SECURE ID: ${item.id.toUpperCase()}-${Math.floor(Math.random()*9999)}</div>
                    <div>COORDS: ${item.mapCoords.x}, ${item.mapCoords.y}</div>
                </div>
            `;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // ================= 背景星空 =================
        const canvas = document.getElementById('starCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 1.5;
                this.speedX = (Math.random() - 0.5) * 0.2;
                this.speedY = (Math.random() - 0.5) * 0.2;
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if(this.x > width) this.x = 0; else if(this.x < 0) this.x = width;
                if(this.y > height) this.y = 0; else if(this.y < 0) this.y = height;
            }
            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initStars() {
            resize();
            particles = [];
            for(let i = 0; i < 150; i++) particles.push(new Particle());
            animateStars();
        }

        function animateStars() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateStars);
        }

        // ================= 时钟 =================
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toISOString().split('T')[1].split('.')[0] + " UTC";
        }, 1000);

        // ================= 拖拽逻辑 (保留) =================
        function allowDrop(ev) { ev.preventDefault(); }
        function drop(ev) {
            ev.preventDefault();
            const card = ev.currentTarget;
            if (ev.dataTransfer.getData("text/plain") === "secret") {
                card.style.borderColor = '#fff';
                card.style.boxShadow = '0 0 50px #fff';
                setTimeout(() => { card.style = ''; }, 1000);
            }
        }
        const gem = document.getElementById('secretGem');
        gem.addEventListener('dragstart', (e) => e.dataTransfer.setData("text/plain", "secret"));

        // ================= 初始化 =================
        document.addEventListener('DOMContentLoaded', () => {
            initStars();
            renderGrid();
            renderMap();
        });

    </script>
</body>
</html>
